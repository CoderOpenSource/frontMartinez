import{a as j}from"./chunk-VQFNXLW7.js";import{a as D,b as $,e as F,k as N}from"./chunk-BTD7GRPP.js";import{b as L}from"./chunk-ZBLQCJ4V.js";import{$a as _,Da as l,Ea as v,Ra as h,Rb as T,Sb as k,Ta as p,Tb as H,Ub as V,Va as a,Wa as i,Xa as M,_a as b,ab as d,ba as C,e as z,fb as o,gb as x,hb as w,ib as y,jb as I,ka as m,kb as E,la as u,lb as S,nb as O,ob as A,pb as P}from"./chunk-IG4KVHXC.js";var g=z(j());function B(r,s){r&1&&(a(0,"div",3),M(1,"div",4),i())}function W(r,s){if(r&1){let n=b();a(0,"button",13),_("click",function(){m(n);let t=d().$implicit,c=d(2);return u(c.abrirModal(t.id))}),o(1," Atendida "),i()}}function q(r,s){if(r&1){let n=b();a(0,"button",14),_("click",function(){m(n);let t=d().$implicit,c=d(2);return u(c.cancelarCita(t.id))}),o(1," Cancelar "),i()}}function G(r,s){if(r&1&&(a(0,"tr")(1,"td"),o(2),i(),a(3,"td"),o(4),i(),a(5,"td"),o(6),i(),a(7,"td"),o(8),i(),a(9,"td"),o(10),i(),a(11,"td"),o(12),i(),a(13,"td"),h(14,W,2,0,"button",11)(15,q,2,0,"button",12),i()()),r&2){let n=s.$implicit,e=d(2);l(2),x(n.fecha),l(2),x(n.hora),l(2),y("",n.pacienteNombre," ",n.pacienteApellido,""),l(2),x(n.especialidadNombre),l(2),x(n.estado),l(2),x(n.observaciones||"No atendida"),l(2),p("ngIf",n.estado!=="atendida"&&e.puedeAceptarCita(n)),l(),p("ngIf",n.estado!=="atendida"&&e.puedeCancelarCita(n)&&n.estado!=="cancelada")}}function R(r,s){r&1&&(a(0,"div",15),o(1," No hay citas asignadas. "),i())}function U(r,s){if(r&1&&(a(0,"div",5)(1,"h1",6),o(2,"Citas del M\xE9dico"),i(),a(3,"p",7),o(4),A(5,"date"),i(),a(6,"table",8)(7,"thead")(8,"tr")(9,"th"),o(10,"Fecha"),i(),a(11,"th"),o(12,"Hora"),i(),a(13,"th"),o(14,"Paciente"),i(),a(15,"th"),o(16,"Especialidad"),i(),a(17,"th"),o(18,"Estado"),i(),a(19,"th"),o(20,"Observaciones"),i(),a(21,"th"),o(22,"Acciones"),i()()(),a(23,"tbody"),h(24,G,16,9,"tr",9),i()(),h(25,R,2,0,"div",10),i()),r&2){let n=d();l(4),w("Hora actual: ",P(5,3,n.horaActual,"HH:mm:ss"),""),l(20),p("ngForOf",n.citas),l(),p("ngIf",n.citas.length===0)}}function J(r,s){if(r&1){let n=b();a(0,"div",16)(1,"div",17)(2,"h2",18),o(3,"A\xF1adir Observaciones"),i(),a(4,"textarea",19),S("ngModelChange",function(t){m(n);let c=d();return E(c.observaciones,t)||(c.observaciones=t),u(t)}),i(),a(5,"div",20)(6,"button",21),_("click",function(){m(n);let t=d();return u(t.cerrarModal())}),o(7,"Cancelar"),i(),a(8,"button",22),_("click",function(){m(n);let t=d();return u(t.aceptarCitaConObservaciones())}),o(9,"Guardar"),i()()()()}if(r&2){let n=d();l(4),I("ngModel",n.observaciones)}}var et=(()=>{let s=class s{constructor(e){this.http=e,this.citas=[],this.isLoading=!1,this.horaActual=new Date,this.showModal=!1,this.observaciones="",this.citaSeleccionadaId=null,this.medicoId=parseInt(localStorage.getItem("medicoId")||"0",10)}ngOnInit(){this.loadCitas(),this.actualizarHoraActual(),setInterval(()=>this.actualizarHoraActual(),6e4)}loadCitas(){this.isLoading=!0,this.http.get("http://143.198.147.110/api/citas").subscribe(e=>{this.citas=e.filter(t=>t.medicoId===this.medicoId),this.isLoading=!1},e=>{this.isLoading=!1,g.default.fire({title:"Error al cargar citas",text:"Por favor, int\xE9ntalo nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),console.error("Error loading citas",e)})}aceptarCitaConObservaciones(){if(this.citaSeleccionadaId===null)return;this.isLoading=!0;let e=`http://143.198.147.110/api/citas/aceptar?citaId=${this.citaSeleccionadaId}&medicoId=${this.medicoId}&observaciones=${encodeURIComponent(this.observaciones)}`;this.http.post(e,{},{responseType:"text"}).subscribe(t=>{g.default.fire("Cita atendida",t,"success"),this.loadCitas(),this.cerrarModal()},t=>{this.isLoading=!1,g.default.fire({title:"Error al aceptar cita",text:"Por favor, int\xE9ntalo nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),console.error("Error al aceptar cita",t)})}cancelarCita(e){this.isLoading=!0,this.http.post(`http://143.198.147.110/api/citas/cancelar/medico?citaId=${e}&medicoId=${this.medicoId}`,{},{responseType:"text"}).subscribe(t=>{g.default.fire("Cita cancelada",t,"success"),this.loadCitas()},t=>{this.isLoading=!1,g.default.fire({title:"Error al cancelar cita",text:"Por favor, int\xE9ntalo nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),console.error("Error al cancelar cita",t)})}abrirModal(e){this.citaSeleccionadaId=e,this.showModal=!0,this.observaciones=""}cerrarModal(){this.showModal=!1,this.citaSeleccionadaId=null,this.observaciones=""}actualizarHoraActual(){this.horaActual=new Date}puedeAceptarCita(e){let t=new Date(`${e.fecha}T${e.hora}`),c=new Date(t);c.setHours(c.getHours()+1),console.log("--- Validando si se puede aceptar la cita ---"),console.log("Hora actual (zona horaria local):",this.horaActual),console.log("Hora de la cita:",t),console.log("L\xEDmite para aceptar:",c);let f=this.horaActual>=t&&this.horaActual<=c;return console.log("\xBFSe puede aceptar la cita?",f),f}puedeCancelarCita(e){let t=new Date(`${e.fecha}T${e.hora}`),c=new Date(t);c.setMinutes(c.getMinutes()-1),console.log("--- Validando si se puede cancelar la cita ---"),console.log("Hora actual (zona horaria local):",this.horaActual),console.log("Hora de la cita:",t),console.log("L\xEDmite para cancelar (1 minuto antes de la cita):",c);let f=this.horaActual<=c;return console.log("\xBFSe puede cancelar la cita?",f),f}};s.\u0275fac=function(t){return new(t||s)(v(L))},s.\u0275cmp=C({type:s,selectors:[["app-medico-citas"]],standalone:!0,features:[O],decls:3,vars:3,consts:[["class","spinner-container",4,"ngIf"],["class","container mx-auto px-4 py-8",4,"ngIf"],["class","fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"container","mx-auto","px-4","py-8"],[1,"text-2xl","font-bold","mb-4","text-center"],[1,"text-center","mb-4","text-gray-600"],[1,"min-w-full","bg-white","shadow-lg","rounded-lg"],[4,"ngFor","ngForOf"],["class","text-center text-gray-600 mt-4",4,"ngIf"],["class","bg-blue-500 text-white px-3 py-1 rounded-lg font-bold",3,"click",4,"ngIf"],["class","bg-red-500 text-white px-3 py-1 rounded-lg font-bold",3,"click",4,"ngIf"],[1,"bg-blue-500","text-white","px-3","py-1","rounded-lg","font-bold",3,"click"],[1,"bg-red-500","text-white","px-3","py-1","rounded-lg","font-bold",3,"click"],[1,"text-center","text-gray-600","mt-4"],[1,"fixed","inset-0","bg-gray-800","bg-opacity-75","flex","items-center","justify-center"],[1,"bg-white","rounded-lg","p-6","w-1/3"],[1,"text-xl","font-bold","mb-4"],["rows","5","placeholder","Escribe tus observaciones aqu\xED...",1,"w-full","border","border-gray-300","rounded-md","p-2","mb-4",3,"ngModelChange","ngModel"],[1,"flex","justify-end","space-x-4"],[1,"bg-gray-500","text-white","px-4","py-2","rounded-lg",3,"click"],[1,"bg-blue-500","text-white","px-4","py-2","rounded-lg",3,"click"]],template:function(t,c){t&1&&h(0,B,2,0,"div",0)(1,U,26,6,"div",1)(2,J,10,1,"div",2),t&2&&(p("ngIf",c.isLoading),l(),p("ngIf",!c.isLoading),l(),p("ngIf",c.showModal))},dependencies:[V,T,k,H,N,D,$,F],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]});let r=s;return r})();export{et as MedicoCitasComponent};

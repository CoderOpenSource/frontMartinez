import{a as A}from"./chunk-VQFNXLW7.js";import{a as k,b as T,e as $,k as B}from"./chunk-BTD7GRPP.js";import{b as L}from"./chunk-ZBLQCJ4V.js";import{$a as x,Aa as P,Da as l,Ea as I,Ra as h,Rb as O,Sb as D,Ta as m,Ub as F,Va as n,Wa as i,Xa as C,ab as b,ba as _,e as N,fb as r,gb as g,ib as y,jb as w,kb as E,lb as M,nb as S}from"./chunk-IG4KVHXC.js";var d=N(A());function V(o,c){o&1&&(n(0,"div",8),C(1,"div",9),i())}function j(o,c){if(o&1&&(n(0,"a",13),r(1,"Ver archivo"),i()),o&2){let s=b().$implicit;m("href",s.archivoUrl,P)}}function z(o,c){if(o&1&&(n(0,"tr")(1,"td"),r(2),i(),n(3,"td"),r(4),i(),n(5,"td"),r(6),i(),n(7,"td"),r(8),i(),n(9,"td"),h(10,j,2,1,"a",12),i()()),o&2){let s=c.$implicit;l(2),g(s.fecha),l(2),y("",s.pacienteNombre," ",s.pacienteApellido,""),l(2),g(s.descripcion),l(2),g(s.observaciones),l(2),m("ngIf",s.archivoUrl)}}function U(o,c){if(o&1&&(n(0,"table",10)(1,"thead")(2,"tr")(3,"th"),r(4,"Fecha"),i(),n(5,"th"),r(6,"Paciente"),i(),n(7,"th"),r(8,"Descripci\xF3n"),i(),n(9,"th"),r(10,"Observaciones"),i(),n(11,"th"),r(12,"Archivo"),i()()(),n(13,"tbody"),h(14,z,11,6,"tr",11),i()()),o&2){let s=b();l(14),m("ngForOf",s.procedimientos)}}function W(o,c){o&1&&(n(0,"p",14),r(1,"No hay procedimientos disponibles."),i())}var Q=(()=>{let c=class c{constructor(e){this.http=e,this.procedimientos=[],this.consultas=[],this.selectedDate=null,this.loading=!1,this.medicoId=parseInt(localStorage.getItem("medicoId")||"0",10)}ngOnInit(){this.loadProcedimientos(),this.loadConsultas()}loadProcedimientos(){this.loading=!0;let e=`http://143.198.147.110/api/procedimientos/medico/${this.medicoId}`;this.selectedDate&&(e+=`?fecha=${this.selectedDate}`),this.http.get(e).subscribe({next:t=>{this.procedimientos=t,this.loading=!1},error:t=>{this.loading=!1,d.default.fire("Error al cargar procedimientos","Por favor, int\xE9ntalo nuevamente.","error"),console.error("Error al cargar procedimientos",t)}})}loadConsultas(){this.loading=!0;let e=new Date().toLocaleString("es-BO",{timeZone:"America/La_Paz",year:"numeric",month:"2-digit",day:"2-digit"}),[t,a,p]=e.split("/"),u=`${p}-${a}-${t}`;this.http.get(`http://143.198.147.110/api/consultas/medico/${this.medicoId}`).subscribe({next:f=>{this.consultas=f.filter(v=>v.derivoProcedimiento),this.loading=!1},error:f=>{this.loading=!1,d.default.fire("Error al cargar consultas","Por favor, int\xE9ntalo nuevamente.","error"),console.error("Error al cargar consultas",f)}})}crearProcedimiento(){d.default.fire({title:"Crear Procedimiento",html:`
      <p>Selecciona una Consulta</p>
      <select id="consultaId" class="swal2-input">
        <option value="" disabled selected>Seleccione una consulta v\xE1lida</option>
        ${this.consultas.map(e=>`<option value="${e.id}">${e.fecha} - ${e.pacienteNombre}</option>`).join("")}
      </select>
      <p>Descripci\xF3n del Procedimiento</p>
      <textarea id="descripcion" class="swal2-textarea" placeholder="Descripci\xF3n"></textarea>
      <p>Observaciones</p>
      <textarea id="observaciones" class="swal2-textarea" placeholder="Observaciones"></textarea>
      <p>Fecha del Procedimiento</p>
      <input id="fecha" type="date" class="swal2-input">
      <p>Archivo Opcional</p>
      <input id="archivo" type="file" class="swal2-input">
    `,preConfirm:()=>{let e=document.getElementById("consultaId").value,t=document.getElementById("descripcion").value,a=document.getElementById("observaciones").value,p=document.getElementById("fecha").value,u=document.getElementById("archivo");if(!e)return d.default.showValidationMessage("Por favor, selecciona una consulta v\xE1lida"),null;if(!t||!p)return d.default.showValidationMessage("Por favor, completa todos los campos obligatorios"),null;let f=this.consultas.find(v=>v.id===parseInt(e,10));return f?{consultaId:parseInt(e,10),pacienteId:f.pacienteId,medicoId:this.medicoId,descripcion:t,observaciones:a,fecha:p,archivo:u.files?.[0]||null}:(d.default.showValidationMessage("Consulta no v\xE1lida seleccionada"),null)}}).then(e=>{if(e.isConfirmed){let t=new FormData;t.append("consultaId",e.value?.consultaId.toString()),t.append("pacienteId",e.value?.pacienteId.toString()),t.append("medicoId",e.value?.medicoId.toString()),t.append("descripcion",e.value?.descripcion),t.append("observaciones",e.value?.observaciones),t.append("fecha",e.value?.fecha),e.value?.archivo&&t.append("archivo",e.value?.archivo),this.loading=!0,this.http.post("http://143.198.147.110/api/procedimientos",t).subscribe({next:()=>{this.loading=!1,d.default.fire("Procedimiento creado","El procedimiento fue creado exitosamente","success"),this.loadProcedimientos()},error:a=>{this.loading=!1,d.default.fire("Error al crear procedimiento","Por favor, int\xE9ntalo nuevamente.","error"),console.error("Error al crear procedimiento",a)}})}})}filtrarProcedimientosPorFecha(){this.loadProcedimientos()}};c.\u0275fac=function(t){return new(t||c)(I(L))},c.\u0275cmp=_({type:c,selectors:[["app-procedimientos-list"]],standalone:!0,features:[S],decls:10,vars:4,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"text-2xl","font-bold","mb-4","text-center"],[1,"mb-4","flex","justify-between","items-center"],["type","date",1,"border","rounded","px-3","py-2",3,"ngModelChange","change","ngModel"],[1,"bg-blue-500","text-white","px-4","py-2","rounded",3,"click"],["class","spinner-container",4,"ngIf"],["class","min-w-full bg-white shadow-lg rounded-lg",4,"ngIf"],["class","text-center text-gray-500",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"min-w-full","bg-white","shadow-lg","rounded-lg"],[4,"ngFor","ngForOf"],["target","_blank","class","text-blue-500 underline",3,"href",4,"ngIf"],["target","_blank",1,"text-blue-500","underline",3,"href"],[1,"text-center","text-gray-500"]],template:function(t,a){t&1&&(n(0,"div",0)(1,"h1",1),r(2,"Lista de Procedimientos"),i(),n(3,"div",2)(4,"input",3),M("ngModelChange",function(u){return E(a.selectedDate,u)||(a.selectedDate=u),u}),x("change",function(){return a.filtrarProcedimientosPorFecha()}),i(),n(5,"button",4),x("click",function(){return a.crearProcedimiento()}),r(6,"Crear Procedimiento"),i()(),h(7,V,2,0,"div",5)(8,U,15,1,"table",6)(9,W,2,0,"p",7),i()),t&2&&(l(4),w("ngModel",a.selectedDate),l(3),m("ngIf",a.loading),l(),m("ngIf",a.procedimientos.length>0),l(),m("ngIf",!a.loading&&a.procedimientos.length===0))},dependencies:[F,O,D,B,k,T,$],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]});let o=c;return o})();export{Q as ProcedimientosListComponent};

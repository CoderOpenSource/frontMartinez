import{a as O}from"./chunk-VQFNXLW7.js";import{b as S}from"./chunk-ZBLQCJ4V.js";import{$a as C,Aa as _,Da as l,Ea as I,Ra as f,Rb as y,Sb as P,Ta as c,Ub as L,Va as n,Wa as i,Xa as A,_a as E,ab as g,ba as x,e as M,fb as s,gb as u,ib as h,ka as b,la as v,nb as w}from"./chunk-IG4KVHXC.js";var p=M(O());function T(a,r){a&1&&(n(0,"div",7),A(1,"div",8),i())}function k(a,r){if(a&1){let d=E();n(0,"button",9),C("click",function(){b(d);let o=g();return v(o.crearAnalisis())}),s(1," Crear An\xE1lisis "),i()}}function B(a,r){a&1&&(n(0,"div",10),s(1," No hay pacientes disponibles para crear an\xE1lisis. "),i())}function F(a,r){if(a&1&&(n(0,"tr")(1,"td",15),s(2),i(),n(3,"td",15),s(4),i(),n(5,"td",15),s(6),i(),n(7,"td",15),s(8),i(),n(9,"td",15),s(10),i(),n(11,"td",15)(12,"a",16),s(13,"Ver archivo"),i()()()),a&2){let d=r.$implicit;l(2),u(d.fechaRealizacion),l(2),h("",d.pacienteNombre," ",d.pacienteApellido,""),l(2),u(d.tipoAnalisis),l(2),u(d.resultado),l(2),h("",d.medicoNombre," ",d.medicoApellido,""),l(2),c("href",d.archivoUrl,_)}}function $(a,r){if(a&1&&(n(0,"table",11)(1,"thead")(2,"tr",12)(3,"th",13),s(4,"Fecha"),i(),n(5,"th",13),s(6,"Paciente"),i(),n(7,"th",13),s(8,"Tipo de An\xE1lisis"),i(),n(9,"th",13),s(10,"Resultado"),i(),n(11,"th",13),s(12,"M\xE9dico"),i(),n(13,"th",13),s(14,"Archivo"),i()()(),n(15,"tbody"),f(16,F,14,8,"tr",14),i()()),a&2){let d=g();l(16),c("ngForOf",d.analisisList)}}function z(a,r){a&1&&(n(0,"div",17),s(1," No hay an\xE1lisis disponibles. "),i())}var j=(()=>{let r=class r{constructor(e){this.http=e,this.analisisList=[],this.citasAtendidas=[],this.pacientes=[],this.tiposAnalisis=["Hemograma completo","Prueba de glucosa","Perfil lip\xEDdico","Prueba de funci\xF3n hep\xE1tica","Prueba de tiroides","Prueba de embarazo","Uroan\xE1lisis","Prueba de VIH","Cultivo de sangre","Panel metab\xF3lico completo"],this.isLoading=!1,this.usuarioId=parseInt(localStorage.getItem("medicoId")||"0",10)}ngOnInit(){this.loadAnalisis(),this.loadCitasAtendidas(),this.loadPacientes()}loadAnalisis(){this.isLoading=!0,this.http.get(`http://143.198.147.110/api/analisis/medico/${this.usuarioId}`).subscribe(e=>{this.analisisList=e,this.isLoading=!1},e=>{this.isLoading=!1,p.default.fire({title:"Error al cargar an\xE1lisis",text:"Por favor, int\xE9ntalo nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),console.error("Error al cargar an\xE1lisis",e)})}loadCitasAtendidas(){this.isLoading=!0,this.http.get("http://143.198.147.110/api/citas").subscribe(e=>{this.citasAtendidas=e.filter(o=>o.estado==="atendida"&&o.medicoId===this.usuarioId),this.isLoading=!1},e=>{this.isLoading=!1,p.default.fire({title:"Error al cargar citas",text:"Por favor, int\xE9ntalo nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),console.error("Error al cargar citas",e)})}loadPacientes(){this.isLoading=!0,this.http.get("http://143.198.147.110/api/pacientes").subscribe(e=>{let o=new Set(this.citasAtendidas.map(t=>t.pacienteId));this.pacientes=e.filter(t=>o.has(t.id)),this.isLoading=!1},e=>{this.isLoading=!1,p.default.fire({title:"Error al cargar pacientes",text:"Por favor, int\xE9ntalo nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),console.error("Error al cargar pacientes",e)})}crearAnalisis(){p.default.fire({title:"Crear An\xE1lisis",html:`
       <p>Selecciona un Paciente</p>
      <select id="pacienteId" class="swal2-input">
        ${this.pacientes.map(e=>`<option value="${e.id}">${e.usuario.nombre} ${e.usuario.apellido}</option>`).join("")}
      </select>
      <p>Selecciona un tipo de An\xE1lisis</p>
      <select id="tipoAnalisis" class="swal2-input">
        ${this.tiposAnalisis.map(e=>`<option value="${e}">${e}</option>`).join("")}
      </select>
      <textarea id="resultado" class="swal2-textarea" placeholder="Resultado"></textarea>
      <input id="archivoUrl" type="file" class="swal2-input">
    `,focusConfirm:!1,preConfirm:()=>{let e=document.getElementById("pacienteId").value,o=document.getElementById("tipoAnalisis").value,t=document.getElementById("resultado").value,m=document.getElementById("archivoUrl");return!e||!o||!m.files||m.files.length===0?(p.default.showValidationMessage("Todos los campos son obligatorios"),null):{pacienteId:parseInt(e),tipoAnalisis:o,resultado:t,archivo:m.files[0]}}}).then(e=>{if(e.isConfirmed){this.isLoading=!0;let o=this.getFechaBolivia(),t=new FormData;t.append("pacienteId",e.value?.pacienteId.toString()),t.append("medicoId",this.usuarioId.toString()),t.append("tipoAnalisis",e.value?.tipoAnalisis),t.append("resultado",e.value?.resultado),t.append("fechaRealizacion",o),t.append("archivo",e.value?.archivo),this.http.post("http://143.198.147.110/api/analisis",t).subscribe(()=>{this.isLoading=!1,p.default.fire("An\xE1lisis creado","El an\xE1lisis se ha creado exitosamente","success"),this.loadAnalisis()},m=>{this.isLoading=!1,p.default.fire({title:"Error al crear an\xE1lisis",text:"Por favor, int\xE9ntalo nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),console.error("Error al crear an\xE1lisis",m)})}})}getFechaBolivia(){let e=new Date;return new Date(e.getTime()-(e.getTimezoneOffset()+240)*6e4).toISOString().split("T")[0]}};r.\u0275fac=function(o){return new(o||r)(I(S))},r.\u0275cmp=x({type:r,selectors:[["app-analisis-list"]],standalone:!0,features:[w],decls:8,vars:5,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"text-2xl","font-bold","mb-4","text-center"],["class","spinner-container",4,"ngIf"],["class","bg-green-500 text-white px-4 py-2 rounded-lg mb-4",3,"click",4,"ngIf"],["class","text-center text-red-500 mb-4",4,"ngIf"],["class","min-w-full bg-white shadow-lg rounded-lg",4,"ngIf"],["class","text-center text-gray-500",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"bg-green-500","text-white","px-4","py-2","rounded-lg","mb-4",3,"click"],[1,"text-center","text-red-500","mb-4"],[1,"min-w-full","bg-white","shadow-lg","rounded-lg"],[2,"background-color","#343a40","color","white"],[1,"px-4","py-2"],[4,"ngFor","ngForOf"],[1,"border","px-4","py-2"],["target","_blank",1,"text-blue-500","underline",3,"href"],[1,"text-center","text-gray-500"]],template:function(o,t){o&1&&(n(0,"div",0)(1,"h1",1),s(2,"Mis An\xE1lisis"),i(),f(3,T,2,0,"div",2)(4,k,2,0,"button",3)(5,B,2,0,"div",4)(6,$,17,1,"table",5)(7,z,2,0,"div",6),i()),o&2&&(l(3),c("ngIf",t.isLoading),l(),c("ngIf",t.pacientes.length>0),l(),c("ngIf",t.pacientes.length===0&&!t.isLoading),l(),c("ngIf",t.analisisList.length>0),l(),c("ngIf",t.analisisList.length===0&&!t.isLoading))},dependencies:[L,y,P],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]});let a=r;return a})();export{j as AnalisisListComponent};

import{a as $}from"./chunk-VQFNXLW7.js";import{b as M}from"./chunk-ZBLQCJ4V.js";import{$a as f,Da as p,Ea as E,Ra as b,Rb as y,Sb as R,Ta as m,Ub as S,Va as i,Wa as t,Xa as I,_a as C,ab as g,ba as v,e as F,fb as r,gb as u,ka as h,la as x,nb as w}from"./chunk-IG4KVHXC.js";var s=F($());function k(a,l){a&1&&(i(0,"div",7),I(1,"div",8),t())}function T(a,l){a&1&&(i(0,"div",9),r(1," No hay reportes disponibles. "),t())}function B(a,l){if(a&1){let c=C();i(0,"tr")(1,"td",12),r(2),t(),i(3,"td",12),r(4),t(),i(5,"td",12),r(6),t(),i(7,"td",12),r(8),t(),i(9,"td",12)(10,"button",14),f("click",function(){let n=h(c).$implicit,o=g(2);return x(o.descargarReporte(n))}),r(11," Ver "),t(),i(12,"button",15),f("click",function(){let n=h(c).$implicit,o=g(2);return x(o.eliminarReporte(n.id))}),r(13," Eliminar "),t()()()}if(a&2){let c=l.$implicit;p(2),u(c.id),p(2),u(c.titulo),p(2),u(c.tipo),p(2),u(c.fechaGeneracion)}}function N(a,l){if(a&1&&(i(0,"table",10)(1,"thead")(2,"tr",11)(3,"th",12),r(4,"ID"),t(),i(5,"th",12),r(6,"T\xEDtulo"),t(),i(7,"th",12),r(8,"Tipo"),t(),i(9,"th",12),r(10,"Fecha de Generaci\xF3n"),t(),i(11,"th",12),r(12,"Acciones"),t()()(),i(13,"tbody"),b(14,B,14,4,"tr",13),t()()),a&2){let c=g();p(14),m("ngForOf",c.reportes)}}var j=(()=>{let l=class l{constructor(e){this.http=e,this.reportes=[],this.pacientes=[],this.medicos=[],this.especialidades=[],this.isLoading=!1}ngOnInit(){this.cargarReportes(),this.cargarDatosIniciales()}cargarReportes(){this.isLoading=!0,this.http.get("http://143.198.147.110/api/reportes").subscribe({next:e=>{this.reportes=e,this.isLoading=!1},error:()=>{s.default.fire("Error","No se pudieron cargar los reportes.","error"),this.isLoading=!1}})}cargarDatosIniciales(){this.http.get("http://143.198.147.110/api/pacientes").subscribe({next:e=>{this.pacientes=e},error:()=>{s.default.fire("Error","No se pudieron cargar los pacientes.","error")}}),this.http.get("http://143.198.147.110/api/medicos").subscribe({next:e=>{this.medicos=e},error:()=>{s.default.fire("Error","No se pudieron cargar los m\xE9dicos.","error")}}),this.http.get("http://143.198.147.110/api/especialidades").subscribe({next:e=>{this.especialidades=e},error:()=>{s.default.fire("Error","No se pudieron cargar las especialidades.","error")}})}eliminarReporte(e){s.default.fire({title:"\xBFEst\xE1s seguro?",text:"Esta acci\xF3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&this.http.delete(`http://143.198.147.110/api/reportes/${e}`).subscribe({next:()=>{s.default.fire("Eliminado","El reporte ha sido eliminado.","success"),this.cargarReportes()},error:()=>{s.default.fire("Eliminado","El reporte ha sido eliminado.","success"),this.cargarReportes()}})})}descargarReporte(e){window.open(e.archivoUrl,"_blank")}generarReporte(){s.default.fire({title:"Generar Reporte",html:`
      <select id="tipo" class="swal2-select">
        <option value="consultas">Consultas</option>
        <option value="procedimientos">Procedimientos</option>
        <option value="analisis">An\xE1lisis</option>
      </select>
      <select id="formato" class="swal2-select">
        <option value="pdf">PDF</option>
        <option value="excel">Excel</option>
      </select>
      <select id="pacienteId" class="swal2-select">
        <option value="">Seleccione un paciente</option>
        ${this.pacientes.map(e=>`<option value="${e.id}">${e.usuario.nombre} ${e.usuario.apellido} (${e.carnet})</option>`)}
      </select>
      <select id="medicoId" class="swal2-select">
        <option value="">Seleccione un m\xE9dico</option>
        ${this.medicos.map(e=>`<option value="${e.id}">${e.nombre} ${e.apellido}</option>`)}
      </select>
      <select id="especialidadId" class="swal2-select">
        <option value="">Seleccione una especialidad</option>
        ${this.especialidades.map(e=>`<option value="${e.id}">${e.nombre}</option>`)}
      </select>
      <input id="fechaInicio" type="date" class="swal2-input" placeholder="Fecha Inicio">
      <input id="fechaFin" type="date" class="swal2-input" placeholder="Fecha Fin">
    `,focusConfirm:!1,showCancelButton:!0,preConfirm:()=>{let e=document.getElementById("tipo").value,n=document.getElementById("formato").value,o=document.getElementById("pacienteId").value||null,d=document.getElementById("medicoId").value||null,_=document.getElementById("especialidadId").value||null,O=document.getElementById("fechaInicio").value||null,P=document.getElementById("fechaFin").value||null;return!e||!n?(s.default.showValidationMessage("Por favor, complete todos los campos obligatorios."),null):{tipo:e,formato:n,parametros:{pacienteId:o?Number(o):null,medicoId:d?Number(d):null,especialidadId:_?Number(_):null,fechaInicio:O,fechaFin:P}}}}).then(e=>{if(e.isConfirmed){let{tipo:n,formato:o,parametros:d}=e.value;this.isLoading=!0,this.http.post("http://143.198.147.110/api/reportes",{tipo:n,formato:o,parametros:d}).subscribe({next:()=>{this.isLoading=!1,s.default.fire("Reporte Generado","El reporte fue creado exitosamente.","success"),this.cargarReportes()},error:()=>{this.isLoading=!1,s.default.fire("Error","No se pudo generar el reporte.","error")}})}})}};l.\u0275fac=function(n){return new(n||l)(E(M))},l.\u0275cmp=v({type:l,selectors:[["app-reportes"]],standalone:!0,features:[w],decls:9,vars:3,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"text-2xl","font-bold","mb-4","text-center"],[1,"mb-4","text-right"],[1,"bg-green-500","text-white","px-4","py-2","rounded",3,"click"],["class","spinner-container",4,"ngIf"],["class","text-center text-gray-600",4,"ngIf"],["class","table-auto w-full border-collapse",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"text-center","text-gray-600"],[1,"table-auto","w-full","border-collapse"],[1,"bg-gray-200"],[1,"border","px-4","py-2"],[4,"ngFor","ngForOf"],[1,"bg-blue-500","text-white","px-2","py-1","rounded",3,"click"],[1,"bg-red-500","text-white","px-2","py-1","rounded",3,"click"]],template:function(n,o){n&1&&(i(0,"div",0)(1,"h1",1),r(2,"Gesti\xF3n de Reportes"),t(),i(3,"div",2)(4,"button",3),f("click",function(){return o.generarReporte()}),r(5," Generar Reporte "),t()(),b(6,k,2,0,"div",4)(7,T,2,0,"div",5)(8,N,15,1,"table",6),t()),n&2&&(p(6),m("ngIf",o.isLoading),p(),m("ngIf",!o.isLoading&&o.reportes.length===0),p(),m("ngIf",!o.isLoading&&o.reportes.length>0))},dependencies:[S,y,R],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]});let a=l;return a})();export{j as ReportesComponent};
